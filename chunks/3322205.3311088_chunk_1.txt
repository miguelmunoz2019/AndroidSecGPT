# Check lorUpdalc $  App in the Middle: Demystify Application Virtualization in Android and its Security Threats
# LEI ZHANG, Fudan University, China
# ZHEMIN YANG, Fudan University, China
# YUYU HE, Fudan University, China
# MINGQI LI, Fudan University, China
# SEN YANG, Fudan University, China
# MIN YANG, Fudan University, China
# YUAN ZHANG, Fudan University, China
# ZHIYUN QIAN, University of California Riverside, USA
Customizability is a key feature of the Android operating system that differentiates it from Apple’s iOS. One concrete feature that gaining popularity is called “app virtualization”. This feature allows multiple copies of the same app to be installed and opened simultaneously (e.g., with multiple accounts logged in). Virtualization frameworks are used by more than 100 million users worldwide. As with any new system features, we are interested in two aspects: (1) whether the feature itself introduces security risks and (2) whether the feature is abused for unintended purposes. This paper conducts a systematic study on the two aspects of the app virtualization techniques.

With a thorough study of 32 popular virtualization frameworks from Google Play, we identify seven areas of potential attack vectors and find that most of the frameworks are susceptible to them. By deeply investigating their ecosystem, we show, with demonstrations, that attackers can easily distribute malware that takes advantage of these attack vectors. In addition, we show that the same virtualization techniques are also abused by malware as an alternative and easy-to-use repackaging mechanism. To this end, we design and implement a new app repackage detector. After scanning 250,145 apps from app markets, it finds 164 repackaged apps that attempt to steal user credentials and private data.

# CCS Concepts:
• Security and privacy → Software and application security; Mobile platform security; Virtualization and security.

# Additional Key Words and Phrases:
Application Virtualization, Access Control, Android Security
# ACM Reference Format:
Lei Zhang, Zhemin Yang, Yuyu He, Mingqi Li, Sen Yang, Min Yang, Yuan Zhang, and Zhiyun Qian. 2019. App in the Middle: Demystify Application Virtualization in Android and its Security Threats. Proc. ACM Meas. Anal. Comput. Syst. 3, 1, Article 17 , 24 pages. https://doi.org/10/3311088
# Authors’ addresses:
Lei Zhang, Fudan University, Shanghai, China, lei_zhang14@fudan.edu.cn; Zhemin Yang, Fudan University, Shanghai, China, yangzhemin@fudan.edu.cn; Yuyu He, Fudan University, Shanghai, China, heyy16@fudan.edu.cn; Mingqi Li, Fudan University, Shanghai, China, limq16@fudan.edu.cn; Sen Yang, Fudan University, Shanghai, China, syang15@fudan.edu.cn; Min Yang, Fudan University, Shanghai, China, m_yang@fudan.edu.cn; Yuan Zhang, Fudan University, Shanghai, China, yuanxzhang@fudan.edu.cn; Zhiyun Qian, University of California Riverside, California Riverside, USA, zhiyunq@cs.ucr.edu.

Permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page. Copyrights for components of this work owned by others than the author(s) must be honored. Abstracting with credit is permitted. To copy otherwise, or republish, to post on servers or to redistribute to lists, requires prior specific permission and/or a fee. Request permissions from permissions@acm.org.

© 2019 Copyright held by the owner/author(s). Publication rights licensed to ACM. 2476-1249/2019/3-ART17 $15 https://doi.org/10/3311088
Proc. ACM Meas. Anal. Comput. Syst., Vol. 3, No. 1, Article 17. Publication date: March 2019.

# 1 INTRODUCTION
As a popular operating system, Android has 2 billion  monthly active devices around the world with a huge number of applications (apps for short) that are connected to our daily life, including social network, games and digital wallets. Android users tend to customize the systems and apps — something that Android offers as a major differentiation factor from Apple. For example, users may want to replace the default theme of Twitter, to mock the device location when playing the game Pokemon Go, or to manage multiple accounts of WhatsApp simultaneously. However, many apps apply obfuscation/packing techniques to prevent themselves from being modified/repackaged.

The demand of app customization forms the basis of the growing popularity of app virtualization in Android, which provides mobile users the capability to easily customize obfuscated/packed Android apps. Specifically, a virtualization framework (an Android app) implements a virtual execution environment, and other apps can be executed on top of it. Then, the framework provides the ability to instrument and modify the virtualized apps. One of the most popular virtualization frameworks, Parallel Space, claims that over 100 million users worldwide are using the app . Besides, considering only Google Play, dozens of virtualization frameworks are available to the public, and they are already downloaded by over 84 million users. As many sensitive apps can be run on top of these virtualization frameworks, the security of these frameworks is critical. Prior work  reported that app virtualization techniques can be abused to launch several attacks. Specifically, two attacks leverage the vulnerabilities of app virtualization frameworks, and the remaining one is a malware that leverages app virtualization to evade the malware detectors. However, since there is a lack of systematic studies of the vulnerabilities in the wild and a deep understanding of the attack surface, the severity of the threat is still unclear.

We first investigate the security mechanisms built into these frameworks. Specifically, app virtualization can be viewed as a new layer of sandboxing infrastructure where apps running on top should be isolated from each other, e.g., one app can not steal data from another. However, app virtualization inherently changes the assumption of the Android’s original sandboxing mechanism. That is, from the Android operating system’s perspective, it fails to identify different virtualized apps executed in the same virtualization framework. It is the app virtualization framework’s responsibility to further isolate the apps running on top. We empirically analyze the 32 popular frameworks we collected from Google Play regarding their app isolation mechanisms and security enforcement of access controls. We are surprised to find that the content of any app can be easily stolen/tampered by another. We further study these frameworks by probing whether the Android security considerations remain enforced. Unfortunately, by studying eight Android security considerations, our experiments show that almost all the access control mechanisms are broken in all the virtualization frameworks. Although some frameworks attempt to remediate the broken sandboxing assumptions, we find that attackers can bypass most of them.

Additionally, we study the severeness of these vulnerabilities. Specifically, (1) what apps can be attacked? (2) how can malware be distributed to end-users? By analyzing user reviews of virtualization frameworks on Google Play, we observed that the users mostly utilize these frameworks to customize social apps (about 56%) and games (about 16%). Thus, a lot of user privacy (managed by social apps) are potentially exposed to malware that run on top of the same virtualization framework. Then, we study how users can launch and use Android apps in the virtualization frameworks. We observed that almost all these frameworks support app installations from insecure sources. For example, users can install apk files from globally accessible SD cards, which can be easily tempered with by any app on the same device. Furthermore, some commercial virtualization apps provide embedded app markets with insecure transmission channels. Additionally, a common usage of virtualization frameworks for gaming is to use bots, and game bots are not available on the app.

Proc. ACM Meas. Anal. Comput. Syst., Vol. 3, No. 1, Article 17. Publication date: March 2019.

# App in the Middle
# 17:3
markets . Thus, to install bots, users download and install apps from non-official and insecure sources (e.g., 3rd party game forums). We study a well-known game bots community which utilizes the virtualization frameworks. Interestingly, as we will describe in §4, we find that to instrument game apps, the bots framework is utilizing a vulnerability introduced in this paper. We also illustrate that developers can easily distribute malicious game bots which target virtualization frameworks. An exploitation demo (https://youtu.be/Mk_ZISSitow) is provided to illustrate this attack scenario. Additionally, we observed that an app on Google Play attempts to use one of the vulnerabilities discussed in this paper (details in §7) and we argue that these vulnerabilities may cause severe consequences in the future.